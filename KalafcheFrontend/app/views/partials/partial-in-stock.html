<div ng-controller="InStockController" layout="column" ng-cloak>
    <md-content layout-padding layout="column">
        <div flex>
            <form>
                <div layout="row" layout-xs="column">
                    <div layout-xs="row" flex="33" flex-xs="100">
                        <md-input-container flex="70">
                            <div data-barcode-scanner="barcodeScanned"></div>
                            <label>Баркод</label>
                            <input ng-model="selectedBarcode" maxlength="13">
                        </md-input-container> 
                        <md-input-container flex-offset="5" flex="30">
                            <label>Код</label>
                            <input ng-model="productCode">
                        </md-input-container>  
                    </div>  
                    <div layout-xs="row" flex="33" flex-xs="100">
                        <md-input-container flex style="width:48%">
                            <label>Марка</label>
                            <md-select ng-model="selectedBrand.id" ng-change="resetCurrentPage()">
                                <md-option value="" selected></md-option>
                                <md-option ng-repeat="brand in brands" ng-value="brand.id">
                                    {{brand.name}}
                                </md-option>
                            </md-select>
                        </md-input-container>
                        <md-input-container flex style="width:48%">
                            <label>Модел</label>
                            <md-select ng-model="selectedModel.id"
                                       md-on-close="clearModelSearchTerm()"
                                       data-md-container-class="selectSearchTermHeader"
                                       ng-disabled="!selectedBrand.id" ng-change="resetCurrentPage()">
                              <md-select-header class="select-header">
                                <input id="modelSearchTerm" ng-model="modelSearchTerm"
                                       type="search"
                                       placeholder="Търси модел.."
                                       class="header-searchbox md-text">
                              </md-select-header>
                              <md-option value="" selected>Всички</md-option>
                                <md-option ng-repeat="model in models | filter: {deviceBrandId : selectedBrand.id} : true |
                                  filter:modelSearchTerm" ng-value="model.id">
                                    {{model.name}}
                                </md-option>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div layout-xs="row" flex="30" flex-offset="5" flex-xs="100">
                        <md-input-container flex  flex style="width:100%">
                            <md-select ng-model="selectedKalafcheStore.id" ng-change="getAllInStock()">
                                <md-option value="0">Всички магазини</md-option>
                                <md-option ng-repeat="kalafcheStore in kalafcheStores" ng-value="kalafcheStore.id">
                                    {{kalafcheStore.city}}, {{kalafcheStore.name}}
                                </md-option>
                            </md-select>
                        </md-input-container>
                    </div>
                </div>
            </form>
        </div>
        <div flex>
            <md-button ng-click="openSaleModal()" ng-if="currentSale.selectedStocks.length > 0" class="md-raised md-primary">Текуща продажба</md-button>
        </div>
        <div flex>
            <table class="table table-hover table-condensed">
                <thead>
                    <tr>
                        <th></th>
                        <th>
                            <label>Модел</label>
                        </th>
                        <th>
                            <label>Продукт</label>
                        </th>
                        <th ng-if="selectedKalafcheStore.id == 0">
                            <label>Магазин</label>
                        </th>
                        <th>
                            <label>Цена</label>
                        </th>
                        <th>
                            <label>Брой</label>
                        </th>
                        <th ng-show="!(selectedKalafcheStore.id==4 && isAdmin())">
                            <label ng-show="selectedKalafcheStore.id==4">Моят Магазин</label>
                            <label ng-show="selectedKalafcheStore.id!=4">Склад</label>
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>               
                    <tr dir-paginate="inStock in inStockList | filter:(!!selectedBrand.id || undefined) && {deviceBrandId: selectedBrand.id} : true | filter:(!!selectedModel.id || undefined) && {deviceModelId: selectedModel.id} : true | filter:(!!selectedBarcode || undefined) && {barcode: selectedBarcode} : true | filter:(!!productCode || undefined) && filterByProductCode() | itemsPerPage: inStockPerPage track by $index"  current-page="currentPage" class="item-row">
                        <td>{{(currentPage - 1) * inStockPerPage + $index + 1}}</td>
                        <td>{{inStock.deviceModelName}}</td>
                        <td>{{inStock.productCode}} {{inStock.productName}}</td>
                        <td ng-if="selectedKalafcheStore.id == 0">{{inStock.kalafcheStoreName}}</td>
                        <td>{{inStock.productPrice}}</td>

                        <td>{{inStock.quantity}} <span ng-if="selectedKalafcheStore.id!=4 && inStock.orderedQuantity && inStock.orderedQuantity > 0" class="ordered-stock-quantity"> + {{inStock.orderedQuantity}}</span></td>
                        <td  ng-show="!(selectedKalafcheStore.id==4 && isAdmin())">{{inStock.extraQuantity}}<span ng-if="selectedKalafcheStore.id==4 && inStock.orderedQuantity && inStock.orderedQuantity > 0" class="ordered-stock-quantity"> + {{inStock.orderedQuantity}}</span></td>
                        <td>
                            <a ng-if="inStock.quantity > 0 && !isAdmin() && isEmployeeKalafcheStoreSelected(inStock)" href="" ng-click="openSaleModal(inStock)">
                                <md-icon class="primary-icon" md-svg-src="images/icons/add_shopping_cart.svg"></md-icon>
                            </a>
                            <a ng-if="inStock.quantity > 0 && !isAdmin() && isEmployeeKalafcheStoreSelected(inStock)" href="" ng-click="openWasteModal(inStock)">
                                <md-icon class="primary-icon" md-svg-src="images/icons/delete.svg"></md-icon>
                            </a>
                            <a ng-if="inStock.quantity > 0 && !isAdmin() && !isEmployeeKalafcheStoreSelected(inStock)" href="" ng-click="openRelocationModal(inStock)">
                                <md-icon class="primary-icon" md-svg-src="images/icons/compare_arrows.svg"></md-icon>
                            </a>
                        </td>
                    </tr>
                     <tr ng-show="isTotalSumRowVisible()" class="warning total-sum-row item-row">
                        <td></td>
                        <td></td>
                        <td></td>
                        <td ng-if="selectedKalafcheStore.id == 0"></td>
                        <td></td>
                        <td><b>{{getTotalSum()}}</b></td>
                        <td ng-show="!(selectedKalafcheStore.id==4 && isAdmin())"></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
            <div layout="row" layout-align="center center" class="centered-pagination">
                <dir-pagination-controls template-url="views/directives/dir-pagination.html"></dir-pagination-controls>
            </div>
        </div>
    </md-content>



<!--     <div class="row">
        <div class="col-xs-12">
            <table class="table table-hover table-condensed">
                <thead>
                    <tr>
                        <th></th>
                        <th>
                            <label>Модел</label>
                        </th>
                        <th>
                            <label>Продукт</label>
                        </th>
                        <th ng-if="!selectedKalafcheStore.id">
                            <label>Магазин</label>
                        </th>
                        <th>
                            <label>Цена</label>
                        </th>
                        <th>
                            <label>Брой</label>
                        </th>
                        <th ng-show="!(selectedKalafcheStore.id==4 && isAdmin())">
                            <label ng-show="selectedKalafcheStore.id==4">Моят Магазин</label>
                            <label ng-show="selectedKalafcheStore.id!=4">Склад</label>
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>               
                    <tr dir-paginate="inStock in inStockList | filter:(!!selectedBrand.id || undefined) && {deviceBrandId: selectedBrand.id} : true | filter:(!!selectedModel.id || undefined) && {deviceModelId: selectedModel.id} : true | filter:(!!productCode || undefined) && filterByProductCode() | itemsPerPage: inStockPerPage track by $index"  current-page="currentPage" class="item-row">
                        <td>{{(currentPage - 1) * inStockPerPage + $index + 1}}</td>
                        <td>{{inStock.deviceModelName}}</td>
                        <td>{{inStock.productCode}} {{inStock.productName}}</td>
                        <td ng-if="!selectedKalafcheStore.id">{{inStock.kalafcheStoreName}}</td>
                        <td>{{inStock.productPrice}}</td>

                        <td>{{inStock.quantity}} <span ng-if="selectedKalafcheStore.id!=4 && inStock.orderedQuantity && inStock.orderedQuantity > 0" class="ordered-stock-quantity"> + {{inStock.orderedQuantity}}</span></td>
                        <td  ng-show="!(selectedKalafcheStore.id==4 && isAdmin())">{{inStock.extraQuantity}}<span ng-if="selectedKalafcheStore.id==4 && inStock.orderedQuantity && inStock.orderedQuantity > 0" class="ordered-stock-quantity"> + {{inStock.orderedQuantity}}</span></td>
                        <td>
                            <a ng-if="inStock.quantity > 0 && !isAdmin() && isEmployeeKalafcheStoreSelected(inStock)" href="" ng-click="openSaleModal(inStock)"><span class="glyphicon glyphicon-piggy-bank sell-item-icon"></span></a>
                            <a ng-if="inStock.quantity > 0 && !isAdmin() && !isEmployeeKalafcheStoreSelected(inStock)" href="" ng-click="openRelocationModal(inStock)"><span class="glyphicon glyphicon-share-alt kalafche-icon"></span></a>
                        </td>
                    </tr>
                     <tr ng-show="isTotalSumRowVisible()" class="warning total-sum-row item-row">
                        <td></td>
                        <td></td>
                        <td></td>
                        <td ng-if="!selectedKalafcheStore.id"></td>
                        <td></td>
                        <td><b>{{getTotalSum()}}</b></td>
                        <td ng-show="!(selectedKalafcheStore.id==4 && isAdmin())"></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
            <div class="centered-pagination">
                <dir-pagination-controls template-url="views/directives/dir-pagination.html"></dir-pagination-controls>
            </div>
        </div>
    </div>
    <div class="row" ng-if="currentSale.selectedStocks.length > 0">
        <div class="col-xs-9">          
        </div>
        <div class="col-xs-3">
            <a href="" ng-click="openSaleModal()">Текуща продажба</a>   
        </div>
    </div> -->
</div>